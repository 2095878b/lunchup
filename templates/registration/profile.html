{% extends "base.html" %}

{% load staticfiles %}

{% block title %} Profile {% endblock %}

{% block body_block %}
<div class="page-header">
	<h1>User Profile</h1>
</div>
<div class="hero-unit">
	<p>User: {{ user.username }}</p>
	<p>Real name: <span id ="fullName" class="editableText"></span></p>
	<p>Email: <div id="publicEmail" class="editableText"></div></p>
    <p>About me: <div class="editableArea" id ="about"></div></p>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $.ajax({
          url: '/api/v1/profile/{{ profile.id }}/?format=json',
          type: 'GET',
          accepts: 'application/json',
          dataType: 'json',
          success: function(data, status) {
              $("#about").html(data["about"]);
              $("#fullName").html(data["fullName"]);
              $("#publicEmail").html(data["publicEmail"]);
          },
          error: function(data, status) {
              alert('Something went wrong: ' + data);
          }
        });
    });
    // Function that links tastypie with jeditable
    function tastypie(value, settings) {
        $.ajax({
            headers: {'X-HTTP-Method-Override': 'PATCH'},
            url: '/api/v1/profile/{{ profile.id }}/',
            type: 'POST',
            accepts: 'application/json',
            contentType: 'application/json',
            dataType: 'json',
            data: '{"'+ this.id +'" : "'+ value +'"}',
            processData: false,

            success: function(data, status) {
              //alert('response: ' + JSON.stringify(data));
            },
            error: function(data, status) {
                //alert('Something went wrong: ' + JSON.stringify(data));
            }
        });
        return value;
    }
    // Use editableText class for editable text areas
    $('.editableText').editable(tastypie, {
        type : 'text',
        submit : 'Save',
        tooltip : 'Click to edit...'
    });
    // Use editableArea class for editable text areas
    $('.editableArea').editable(tastypie, {
        type : 'textarea',
        submit : 'Save',
        tooltip : 'Click to edit...'
    });
</script>
{% endblock %}